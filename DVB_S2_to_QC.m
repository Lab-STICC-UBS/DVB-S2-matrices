%DVB_S2_to_parity.m
% Author: Cedric MARCHAND from Lab-STICC

%convert from DVB standard to Quasi Cyclic prototype matrix

clear all;

% CR12
M12=9000;
A12=[20	712 2386	6354	4061	1062	5045	5158 
21	2543	5748	4822	2348	3089	6328	5876 
22	926	5701	269	3693	2438	3190	3507 
23	2802	4520	3577	5324	1091	4667	4449 
24	5140	2003	1263	4742	6497	1185	6202];
B12=[0	4046	6934 
1	2855	66 
2	6694	212 
3	3439	1158 
4	3850	4422 
5	5924	290 
6	1467	4049 
7	7820	2242 
8	4606	3080 
9	4633	7877 
10	3884	6868 
11	8935	4996 
12	3028	764 
13	5988	1057 
14	7411	3450]; 


%CR34 short frame
M34=4320;
A34=[3,3198,478,4207,1481,1009,2616,1924,3437,554,683,1801];
B34=[4,2681,2135
5,3107,4027
6,2637,3373
7,3830,3449
8,4129,2060
9,4184,2742
10,3946,1070
11,2239,984
0,1458,3031
1,3003,1328
2,1137,1716
3,132,3725
4,1817,638
5,1774,3447
6,3632,1257
7,542,3694
8,1015,1945
9,1948,412
10,995,2238
11,4141,1907
0,2480,3079
1,3021,1088
2,713,1379
3,997,3903
4,2323,3361
5,1110,986
6,2532,142
7,1690,2405
8,1298,1881
9,615,174
10,1648,3112
11,1415,2808];

%CR34 normal frame
M34L=16200;
A34L=[
0 6385 7901 14611 13389 11200 3252 5243 2504 2722 821 7374 
1 11359 2698 357 13824 12772 7244 6752 15310 852 2001 11417 
2 7862 7977 6321 13612 12197 14449 15137 13860 1708 6399 13444 
3 1560 11804 6975 13292 3646 3812 8772 7306 5795 14327 7866 
4 7626 11407 14599 9689 1628 2113 10809 9283 1230 15241 4870 
5 1610 5699 15876 9446 12515 1400 6303 5411 14181 13925 7358 
6 4059 8836 3405 7853 7992 15336 5970 10368 10278 9675 4651 
7 4441 3963 9153 2109 12683 7459 12030 12221 629 15212 406 
8 6007 8411 5771 3497 543 14202 875 9186 6235 13908 3563 
9 3232 6625 4795 546 9781 2071 7312 3399 7250 4932 12652 
10 8820 10088 11090 7069 6585 13134 10158 7183 488 7455 9238 
11 1903 10818 119 215 7558 11046 10615 11545 14784 7961 15619 
12 3655 8736 4917 15874 5129 2134 15944 14768 7150 2692 1469 
13 8316 3820 505 8923 6757 806 7957 4216 15589 13244 2622 
14 14463 4852 15733 3041 11193 12860 13673 8152 6551 15108 8758 
];
B34L=[15 3149 11981 
16 13416 6906 
17 13098 13352 
18 2009 14460 
19 7207 4314 
20 3312 3945 
21 4418 6248 
22 2669 13975 
23 7571 9023 
24 14172 2967 
25 7271 7138 
26 6135 13670 
27 7490 14559 
28 8657 2466 
29 8599 12834 
30 3470 3152 
31 13917 4365 
32 6024 13730 
33 10973 14182 
34 2464 13167 
35 5281 15049 
36 1103 1849 
37 2058 1069 
38 9654 6095 
39 14311 7667 
40 15617 8146 
41 4588 11218 
42 13660 6243 
43 8578 7874 
44 11741 2686 
0 1022 1264 
1 12604 9965 
2 8217 2707 
3 3156 11793 
4 354 1514 
5 6978 14058 
6 7922 16079 
7 15087 12138 
8 5053 6470 
9 12687 14932 
10 15458 1763 
11 8121 1721 
12 12431 549 
13 4129 7091 
14 1426 8415 
15 9783 7604 
16 6295 11329 
17 1409 12061 
18 8065 9087 
19 2918 8438 
20 1293 14115 
21 3922 13851 
22 3851 4000 
23 5865 1768 
24 2655 14957 
25 5565 6332 
26 4303 12631 
27 11653 12236 
28 16025 7632 
29 4655 14128 
30 9584 13123 
31 13987 9597 
32 15409 12110 
33 8754 15490 
34 7416 15325 
35 2909 15549 
36 2995 8257 
37 9406 4791 
38 11111 4854 
39 2812 8521 
40 8476 14717 
41 7820 15360 
42 1179 7939 
43 2357 8678 
44 7703 6216 
0 3477 7067 
1 3931 13845 
2 7675 12899 
3 1754 8187 
4 7785 1400 
5 9213 5891 
6 2494 7703 
7 2576 7902 
8 4821 15682 
9 10426 11935 
10 1810 904 
11 11332 9264 
12 11312 3570 
13 14916 2650 
14 7679 7842 
15 6089 13084 
16 3938 2751 
17 8509 4648 
18 12204 8917 
19 5749 12443 
20 12613 4431 
21 1344 4014 
22 8488 13850 
23 1730 14896 
24 14942 7126 
25 14983 8863 
26 6578 8564 
27 4947 396 
28 297 12805 
29 13878 6692 
30 11857 11186 
31 14395 11493 
32 16145 12251 
33 13462 7428 
34 14526 13119 
35 2535 11243 
36 6465 12690 
37 6872 9334 
38 15371 14023 
39 8101 10187 
40 11963 4848 
41 15125 6119 
42 8051 14465 
43 11139 5167 
44 2883 14521];



M=M34L;
A=A34L;
B=B34L;
P=360;


N=64800;
K=N-M;
rate=K/N;
q=M/P;

N_QC=N/P;
M_QC=M/P;
K_QC=K/P;
parity_QC = zeros(M_QC,N_QC);
parity_QC = parity_QC -1;


[ nb_blksA,dv_a  ]=size(A);
[ nb_blksB,dv_b  ]=size(B);



for x=1:nb_blksA
    for i=1:dv_a
        tmp = A(x,i);
        parity_QC(floor(tmp/P)+1 ,x)= mod(tmp,P);
    end
end

for x=1:nb_blksB
    for i=1:dv_b
        tmp = B(x,i);
        parity_QC(floor(tmp/P)+1,x + nb_blksA)= mod(tmp,P);
    end
end


% ira
parity_QC(1,K_QC+1) = 0;
for i=2:M_QC
   parity_QC(i,K_QC+i-1)=0;
   parity_QC(i,K_QC+i)=0;
end

parity_QC

