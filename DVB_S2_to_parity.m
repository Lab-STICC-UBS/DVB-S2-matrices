%DVB_S2_to_parity.m
% Author: Cedric MARCHAND from Lab-STICC

%convert from DVB standard to parity check matrix

%CR45L
M45L=12960;
A45L=[0 149 11212 5575 6360 12559 8108 8505 408 10026 12828 
1 5237 490 10677 4998 3869 3734 3092 3509 7703 10305 
2 8742 5553 2820 7085 12116 10485 564 7795 2972 2157 
3 2699 4304 8350 712 2841 3250 4731 10105 517 7516 
4 12067 1351 11992 12191 11267 5161 537 6166 4246 2363 
5 6828 7107 2127 3724 5743 11040 10756 4073 1011 3422 
6 11259 1216 9526 1466 10816 940 3744 2815 11506 11573 
7 4549 11507 1118 1274 11751 5207 7854 12803 4047 6484 
8 8430 4115 9440 413 4455 2262 7915 12402 8579 7052 
9 3885 9126 5665 4505 2343 253 4707 3742 4166 1556 
10 1704 8936 6775 8639 8179 7954 8234 7850 8883 8713 
11 11716 4344 9087 11264 2274 8832 9147 11930 6054 5455 
12 7323 3970 10329 2170 8262 3854 2087 12899 9497 11700 
13 4418 1467 2490 5841 817 11453 533 11217 11962 5251 
14 1541 4525 7976 3457 9536 7725 3788 2982 6307 5997 
15 11484 2739 4023 12107 6516 551 2572 6628 8150 9852 
16 6070 1761 4627 6534 7913 3730 11866 1813 12306 8249 
17 12441 5489 8748 7837 7660 2102 11341 2936 6712 11977 ];
B45L=[18 10155 4210 
19 1010 10483 
20 8900 10250 
21 10243 12278 
22 7070 4397 
23 12271 3887 
24 11980 6836 
25 9514 4356 
26 7137 10281 
27 11881 2526 
28 1969 11477 
29 3044 10921 
30 2236 8724 
31 9104 6340 
32 7342 8582 
33 11675 10405 
34 6467 12775 
35 3186 12198 
0 9621 11445 
1 7486 5611 
2 4319 4879 
3 2196 344 
4 7527 6650 
5 10693 2440 
6 6755 2706 
7 5144 5998 
8 11043 8033 
9 4846 4435 
10 4157 9228 
11 12270 6562 
12 11954 7592 
13 7420 2592 
14 8810 9636 
15 689 5430 
16 920 1304 
17 1253 11934 
18 9559 6016 
19 312 7589 
20 4439 4197 
21 4002 9555 
22 12232 7779 
23 1494 8782 
24 10749 3969 
25 4368 3479 
26 6316 5342 
27 2455 3493 
28 12157 7405 
29 6598 11495 
30 11805 4455 
31 9625 2090 
32 4731 2321 
33 3578 2608 
34 8504 1849 
35 4027 1151 
0 5647 4935 
1 4219 1870 
2 10968 8054 
3 6970 5447 
4 3217 5638 
5 8972 669 
6 5618 12472 
7 1457 1280 
8 8868 3883 
9 8866 1224 
10 8371 5972 
11 266 4405 
12 3706 3244 
13 6039 5844 
14 7200 3283 
15 1502 11282 
16 12318 2202 
17 4523 965 
18 9587 7011 
19 2552 2051 
20 12045 10306 
21 11070 5104 
22 6627 6906 
23 9889 2121 
24 829 9701 
25 2201 1819 
26 6689 12925 
27 2139 8757 
28 12004 5948 
29 8704 3191 
30 8171 10933 
31 6297 7116 
32 616 7146 
33 5142 9761 
34 10377 8138 
35 7616 5811 
0 7285 9863 
1 7764 10867 
2 12343 9019 
3 4414 8331 
4 3464 642 
5 6960 2039 
6 786 3021 
7 710 2086 
8 7423 5601 
9 8120 4885 
10 12385 11990 
11 9739 10034 
12 424 10162 
13 1347 7597 
14 1450 112 
15 7965 8478 
16 8945 7397 
17 6590 8316 
18 6838 9011 
19 6174 9410 
20 255 113 
21 6197 5835 
22 12902 3844 
23 4377 3505 
24 5478 8672 
25 4453 2132 
26 9724 1380 
27 12131 11526 
28 12323 9511 
29 8231 1752 
30 497 9022 
31 9288 3080 
32 2481 7515 
33 2696 268 
34 4023 12341 
35 7108 5553 ];



% CR12
M12=9000;
A12=[20	712 2386	6354	4061	1062	5045	5158 
21	2543	5748	4822	2348	3089	6328	5876 
22	926	5701	269	3693	2438	3190	3507 
23	2802	4520	3577	5324	1091	4667	4449 
24	5140	2003	1263	4742	6497	1185	6202];
B12=[0	4046	6934 
1	2855	66 
2	6694	212 
3	3439	1158 
4	3850	4422 
5	5924	290 
6	1467	4049 
7	7820	2242 
8	4606	3080 
9	4633	7877 
10	3884	6868 
11	8935	4996 
12	3028	764 
13	5988	1057 
14	7411	3450]; 
%CR23
M23=5400;
A23=[0,2084,1613,1548,1286,1460,3196,4297,2481,3369,3451,4620,2622
1,122,1516,3448,2880,1407,1847,3799,3529,373,971,4358,3108
2,259,3399,929,2650,864,3996,3833,107,5287,164,3125,2350];
B23=[3,342,3529
4,4198,2147
5,1880,4836
6,3864,4910
7,243,1542
8,3011,1436
9,2167,2512
10,4606,1003
11,2835,705
12,3426,2365
13,3848,2474
14,1360,1743
0,163,2536
1,2583,1180
2,1542,509
3,4418,1005
4,5212,5117
5,2155,2922
6,347,2696
7,226,4296
8,1560,487
9,3926,1640
10,149,2928
11,2364,563
12,635,688
13,231,1684
14,1129,3894];

%CR34
M34=4320;
A34=[3,3198,478,4207,1481,1009,2616,1924,3437,554,683,1801];
B34=[4,2681,2135
5,3107,4027
6,2637,3373
7,3830,3449
8,4129,2060
9,4184,2742
10,3946,1070
11,2239,984
0,1458,3031
1,3003,1328
2,1137,1716
3,132,3725
4,1817,638
5,1774,3447
6,3632,1257
7,542,3694
8,1015,1945
9,1948,412
10,995,2238
11,4141,1907
0,2480,3079
1,3021,1088
2,713,1379
3,997,3903
4,2323,3361
5,1110,986
6,2532,142
7,1690,2405
8,1298,1881
9,615,174
10,1648,3112
11,1415,2808];


%CR45
M45=3600;

A45=[5 896 1565 
6 2493 184 
7 212 3210 
8 727 1339 
9 3428 612 
0 2663 1947 
1 230 2695 
2 2025 2794 
3 3039 283 
4 862 2889 
5 376 2110 
6 2034 2286 
7 951 2068 
8 3108 3542 
9 307 1421 
0 2272 1197 
1 1800 3280 
2 331 2308 
3 465 2552 
4 1038 2479 
5 1383 343 
6 94 236 
7 2619 121 
8 1497 2774 
9 2116 1855 
0 722 1584 
1 2767 1881 
2 2701 1610 
3 3283 1732 
4 168 1099 
5 3074 243 
6 3460 945 
7 2049 1746 
8 566 1427 
9 3545 1168];
B45=[];

%airbus cr12
AM12=8192;
AA12=[3828	4191	6128	7846	8061	
43	525	1189	3039	7188	
373	2220	3038	6047	7979	
783	2601	7302	8016	8153	
2848	3344	3925	3982	6724	
234	427	1237	2268	4735	
2089	6775	7738	7965	8095	
232	2911	5697	6163	7479	
1862	2255	2844	5649	6048	
902	1191	3138	3715	4454	
222	541	3181	4188	5544	
739	3469	5549	6259	8067	
1453	2255	2525	3135	4183	
488	3836	4720	5748	6798	
1071	1953	4772	7789	8076	
2819	3484	3831	5255	7036	
2455	3502	3545	3981	5543	
4706	5584	6963	7702	7800	
2568	4323	4807	6570	7828	
59	3546	3956	7779	8183	
658	1105	1311	3365	6427	
645	2604	4535	6662	8032	
344	785	2319	4651	7243	
221	795	2349	4688	6538	
3029	4372	4861	6118	6489	
1495	3969	4792	6746	8187	
178	2917	5385	6869	7022	
2329	3539	6203	8015	8066	
5	391	1238	5452	7200	
501	836	6031	6102	8156	
802	1547	4940	7041	7717	
730	1508	6323	7285	7550	
846	1322	4479	5144	5493	
1171	1792	3963	5467	6396	
3022	3584	4620	4790	7891	
861	1139	1675	3971	7425	
3031	3992	4332	5361	5466	
1617	3834	7097	7646	8163	
1449	2406	3641	7319	7999	
1054	1956	3366	5498	6991	
2261	5303	5820	6281	7370	
57	3316	3631	4253	8136	
1136	3630	5693	5974	6399	
268	2184	5111	5733	6943	
2423	2839	3161	3690	7997	
1824	2255	2812	5946	6830	
349	2360	3477	3876	8044	
968	1413	2937	3209	7920	
403	2204	4938	5221	6276	
273	2275	4286	4447	7388	
421	4182	5417	5976	7236	
1474	3539	4570	5180	5697	
968	1678	3391	4321	7610	
2699	4503	6192	7069	7648	
2873	3773	5273	7709	7826	
1145	3932	4138	5528	7112	
491	590	3871	4355	7045	
310	2122	2267	2606	7087	
850	2637	3531	4346	8187	
1095	4078	4747	5299	7956	
5396	5486	5504	7618	8184	
91	760	2432	5230	5649	
1129	4198	5271	7853	8164	
1992	2706	4559	5488	5683];
AB12=[];






%%



M=M23;
A=A23;
B=B23;
P=360;


N=16200;
K=N-M;
rate=K/N;
parity=zeros(M,N);
q=M/P;

block1=zeros(M,P);
for i=1:P
   block1(1+((i-1)*q),i)=1; 
end

[ nb_blksA,dv_a  ]=size(A);
[ nb_blksB,dv_b  ]=size(B);



for x=1:nb_blksA
    block0=zeros(M,P);
    for i=1:dv_a
        block1_shifted = [ block1( end - A(x,i) + 1:end , :) ; block1(1:end - A(x,i) , :)];
       block0 = block0+ block1_shifted; 
    end
    parity(:, ((x-1)*P+1) : ((x-1)*P + P) ) = block0;
end


for x=1:nb_blksB
    block0=zeros(M,P);
    for i=1:dv_b
        block1_shifted = [ block1( end - B(x,i) + 1:end , :) ; block1(1:end - B(x,i) , :)];
       block0 = block0+ block1_shifted; 
    end
    parity(:, nb_blksA *P+ ((x-1)*P+1) : nb_blksA *P+ ((x-1)*P + P) ) = block0;
end

% ira
parity(1,K+1) = 1;
for i=2:M
   parity(i,K+i-1)=1;
   parity(i,K+i)=1;
end



